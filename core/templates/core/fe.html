{% extends 'core/base.html' %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Frontend ASIC (LArASIC)</h1>

    <!-- Search Bar -->
    <div class="my-4">
        <form id="fe-search-form" class="d-flex" method="GET" action="{% url 'fe' %}">
            <input name="q" class="form-control me-2" type="search" placeholder="Enter search term..." value="{{ search_query }}" aria-label="Search">
            <select name="by" class="form-select me-2" style="width: auto;">
                <option value="sn" {% if search_by == 'sn' %}selected{% endif %}>Serial Number</option>
                <option value="tray" {% if search_by == 'tray' %}selected{% endif %}>RTS Tray ID</option>
                <option value="femb" {% if search_by == 'femb' %}selected{% endif %}>FEMB SN</option>
            </select>
            <button class="btn btn-success" type="submit">Search</button>
        </form>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="row my-4 align-items-center">
                <div class="col-md-6">
                    <span class="badge bg-primary">on FEMB</span>
                    <span class="badge bg-success">total: {{ total_on_femb_count }}</span>
                </div>
                <div class="col-md-6">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mb-0">
                            {% if page_on_femb_obj.has_previous %}
                                <li class="page-item"><a class="page-link" href="?page_on_femb=1&q={{ search_query }}&by={{ search_by }}">&laquo;</a></li>
                                <li class="page-item"><a class="page-link" href="?page_on_femb={{ page_on_femb_obj.previous_page_number }}&q={{ search_query }}&by={{ search_by }}">&#8249;</a></li>
                            {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">&#8249;</a></li>
                            {% endif %}
                
                            <li class="page-item disabled"><a class="page-link" href="#">{{ page_on_femb_obj.number }} of {{ page_on_femb_obj.paginator.num_pages }}</a></li>
                
                            {% if page_on_femb_obj.has_next %}
                                <li class="page-item"><a class="page-link" href="?page_on_femb={{ page_on_femb_obj.next_page_number }}&q={{ search_query }}&by={{ search_by }}">&#8250;</a></li>
                                <li class="page-item"><a class="page-link" href="?page_on_femb={{ page_on_femb_obj.paginator.num_pages }}&q={{ search_query }}&by={{ search_by }}">&raquo;</a></li>
                            {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">&#8250;</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th><a href="?sort_on_femb=serial_number&order_on_femb={% if sort_on_femb == 'serial_number' and order_on_femb == 'asc' %}desc{% else %}asc{% endif %}" class="text-white">Serial Number</a></th>
                            <th><a href="?sort_on_femb=femb__serial_number&order_on_femb={% if sort_on_femb == 'femb__serial_number' and order_on_femb == 'asc' %}desc{% else %}asc{% endif %}" class="text-white">FEMB</a></th>
                            <th><a href="?sort_on_femb=femb_pos&order_on_femb={% if sort_on_femb == 'femb_pos' and order_on_femb == 'asc' %}desc{% else %}asc{% endif %}" class="text-white">FEMB Position</a></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for fe_object in page_on_femb_obj %}
                        <tr>
                            <td><a href="{% url 'fe_detail' serial_number=fe_object.serial_number %}">{{ fe_object.serial_number }}</a></td>
                            <td>
                                {% if fe_object.femb %}
                                    <a href="{% url 'femb_detail' version=fe_object.femb.version serial_number=fe_object.femb.serial_number %}">{{ fe_object.femb.serial_number }}</a>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td>{{ fe_object.femb_pos|default:"-" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-6">
            <div class="row my-4 align-items-center">
                <div class="col-md-6">
                    <span class="badge bg-primary">tested at RTS</span>
                    <span class="badge bg-success">Total: {{ total_rts_count }}</span>
                </div>
                <div class="col-md-6">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mb-0">
                            {% if page_rts_obj.has_previous %}
                                <li class="page-item"><a class="page-link" href="?page_rts=1&q={{ search_query }}&by={{ search_by }}">&laquo;</a></li>
                                <li class="page-item"><a class="page-link" href="?page_rts={{ page_rts_obj.previous_page_number }}&q={{ search_query }}&by={{ search_by }}">&#8249;</a></li>
                            {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">&#8249;</a></li>
                            {% endif %}
                
                            <li class="page-item disabled"><a class="page-link" href="#">{{ page_rts_obj.number }} of {{ page_rts_obj.paginator.num_pages }}</a></li>
                
                            {% if page_rts_obj.has_next %}
                                <li class="page-item"><a class="page-link" href="?page_rts={{ page_rts_obj.next_page_number }}&q={{ search_query }}&by={{ search_by }}">&#8250;</a></li>
                                <li class="page-item"><a class="page-link" href="?page_rts={{ page_rts_obj.paginator.num_pages }}&q={{ search_query }}&by={{ search_by }}">&raquo;</a></li>
                            {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">&#8250;</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th><a href="?sort_rts=serial_number&order_rts={% if sort_rts == 'serial_number' and order_rts == 'asc' %}desc{% else %}asc{% endif %}" class="text-white">Serial Number</a></th>
                            <th><a href="?sort_rts=tray_id&order_rts={% if sort_rts == 'tray_id' and order_rts == 'asc' %}desc{% else %}asc{% endif %}" class="text-white">RTS Tray ID</a></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for fe_object in page_rts_obj %}
                        <tr>
                            <td><a href="{% url 'fe_detail' serial_number=fe_object.serial_number %}">{{ fe_object.serial_number }}</a></td>
                            <td>
                                {% if fe_object.tray_id %}
                                    <a href="{% url 'fe' %}?by=tray&q={{ fe_object.tray_id }}">{{ fe_object.tray_id }}</a>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}